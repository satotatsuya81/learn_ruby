# Business Card Manager - 実装タスクリスト

## 実装計画概要

このタスクリストは、Business Card Managerの段階的実装を目的として作成されています。各タスクは独立して実行可能で、テスト駆動開発（TDD）を前提としています。

## フェーズ1: 開発環境構築とプロジェクト基盤

- [x] 1. 開発環境のセットアップ
  - devcontainer設定ファイルの作成（Ruby 3.3 + YJIT, Rails 7.0, MySQL 8.0, Node.js）
  - Docker Compose設定でMySQL、Redis、Railsアプリケーションコンテナを構成
  - VS Code設定とRuby/Rails開発用拡張機能の設定
  - _要件: Requirement 1（開発環境）_

- [×] 2. Railsプロジェクトの初期化
  - Rails 7.0アプリケーションの作成（API + フルスタック対応）
  - Gemfileの設定（RSpec, FactoryBot, Capybara, Bootstrap, Stimulus等）
  - データベース設定（MySQL接続、環境別設定）
  - _要件: 全体基盤_

- [×] 3. 基本的なプロジェクト構造の構築
  - MVC基本構造の作成
  - ルーティング設定の基盤
  - アプリケーション設定（タイムゾーン、ロケール等）
  - _要件: 全体基盤_

## フェーズ2: 認証・ユーザー管理機能

- [×] 4. ユーザーモデルの実装
  - Userモデルの作成とマイグレーション
  - バリデーション実装（名前、メール、パスワード）
  - has_secure_passwordによる認証機能
  - _要件: Requirement 1_

- [×] 5. ユーザー認証機能の実装
  - SessionsControllerの作成
  - ログイン・ログアウト機能の実装
  - Remember Me機能（永続化セッション）
  - _要件: Requirement 1_

- [×] 6. ユーザー登録機能の実装
  - UsersControllerの作成
  - 新規登録フォームとバリデーション
  - アカウント有効化機能（メール認証）
  - _要件: Requirement 1_

- [×] 7. パスワードリセット機能の実装
  - パスワードリセット用コントローラー
  - リセットトークン生成・検証
  - メール送信機能の実装
  - _要件: Requirement 1_

## フェーズ3: 名刺管理基本機能

- [×] 8. 名刺モデルの実装
  - BusinessCardモデルの作成とマイグレーション
  - バリデーション実装（名前、会社名必須等）
  - Userとのアソシエーション設定
  - _要件: Requirement 2_

- [×] 9. 名刺CRUD機能の実装
  - BusinessCardsControllerの作成
  - 名刺一覧表示機能（index）
  - 名刺詳細表示機能（show）
  - _要件: Requirement 2_

- [×] 10. 名刺作成・編集機能の実装
  - 名刺新規作成フォーム（new, create）
  - 名刺編集フォーム（edit, update）
  - Strong Parametersによる安全な更新
  - _要件: Requirement 2_

- [×] 11. 名刺削除機能の実装
  - 削除確認ダイアログの実装
  - 論理削除または物理削除の実装
  - 削除権限の確認
  - _要件: Requirement 2_

## フェーズ3.5: フロントエンド技術スタック近代化

### 移行戦略と実装指針
このフェーズでは既存のRails ERBビューからTypeScript/React/Reduxへの段階的移行を実施します。既存機能を維持しながら、モダンなフロントエンド技術への移行を進めます。

**移行優先順位**:
1. 型安全性の確保（TypeScript基盤）
2. コンポーネント化（React基本）
3. 状態管理の統一（Redux導入）
4. API通信の型安全化
5. ユーザー体験の向上（インタラクション強化）

**技術的制約**:
- 既存のRails認証・セッション管理システムを維持
- 段階的移行により機能の継続性を確保
- 後方互換性を保ちながら新技術を導入
- テスト駆動開発（TDD）によるReactコンポーネント開発

- [×] 12. TypeScript基盤の構築
  - TypeScript設定ファイル（tsconfig.json）の作成
  - esbuild設定の TypeScript 対応
  - 既存JSファイルのTypeScript移行準備
  - ESLint + TypeScript設定の強化
  - _要件: Requirement 12_

- [×] 13. React基本コンポーネントの実装
  - 名刺一覧のReactコンポーネント化（BusinessCardList.tsx）
  - 名刺カードコンポーネントの作成（BusinessCardItem.tsx）
  - 削除確認モーダルのReact化（DeleteConfirmModal.tsx）
  - Rails ERBからReactコンポーネントへの段階的置き換え
  - _要件: Requirement 12_

- [×] 14. Redux状態管理の導入
  - Redux Toolkit の設定と初期化
  - Business Cards用のSliceとActionの実装
  - 型安全なRedux Store の構築
  - React コンポーネントとRedux の連携
  - _要件: Requirement 12_

- [×] 15. API通信層のTypeScript化
  - Rails API エンドポイントの型定義
  - axiosベースのHTTPクライアント実装
  - CSRF トークン対応とエラーハンドリング
  - APIレスポンスの型安全性確保
  - _要件: Requirement 12_

- [×] 16. インタラクティブ機能の実装
  - リアルタイム検索・フィルタリング機能
  - 楽観的更新によるUX向上
  - フラッシュメッセージのToast通知化
  - ローディング状態とエラー状態の管理
  - _要件: Requirement 12_

## フェーズ4: タグ管理機能

- [ ] 17. タグモデルの実装
  - Tagモデルの作成とマイグレーション
  - BusinessCardTagsの中間テーブル作成
  - many-to-manyアソシエーションの設定
  - _要件: Requirement 4_

- [ ] 18. タグ機能の基本実装
  - 名刺へのタグ追加・削除機能
  - タグの自動作成機能
  - タグ一覧表示機能
  - _要件: Requirement 4_

- [ ] 19. タグ管理画面の実装
  - タグ管理専用コントローラー
  - タグの編集・削除機能
  - タグ使用回数の表示
  - _要件: Requirement 4_

## フェーズ5: 検索・フィルタリング機能

- [ ] 20. 基本検索機能の実装
  - 名前・会社名での部分一致検索
  - 検索フォームの実装
  - 検索結果の表示
  - _要件: Requirement 3_

- [ ] 21. 高度な検索機能の実装
  - 複数条件での絞り込み検索
  - タグによるフィルタリング
  - 日付範囲での検索
  - _要件: Requirement 3_

- [ ] 22. 検索パフォーマンスの最適化
  - データベースインデックスの追加
  - 全文検索機能の実装
  - 検索結果のページネーション
  - _要件: Requirement 3_

## フェーズ6: 画像アップロード機能

- [ ] 23. Active Storageの設定
  - Active Storageの初期化
  - 画像アップロード用の設定
  - 画像バリデーション（形式、サイズ）
  - _要件: Requirement 5_

- [ ] 24. 画像アップロード機能の実装
  - 名刺画像のアップロード機能
  - 画像プレビュー機能
  - 画像の自動リサイズ処理
  - _要件: Requirement 5_

- [ ] 25. 画像表示・管理機能の実装
  - 名刺一覧での画像表示
  - 画像の削除・差し替え機能
  - 画像の最適化表示
  - _要件: Requirement 5_

## フェーズ7: OCR・自動データ抽出機能

- [ ] 26. OCR処理基盤の実装
  - OCR処理用のサービスクラス作成
  - 画像前処理機能の実装
  - OCR結果の構造化処理
  - _要件: Requirement 8_

- [ ] 27. 自動データ抽出機能の実装
  - アップロード画像からのテキスト抽出
  - 抽出データのフォーム自動入力
  - 信頼度スコアの算出・表示
  - _要件: Requirement 8_

- [ ] 28. OCR結果の検証・学習機能
  - ユーザーによる修正内容の記録
  - OCR精度向上のためのデータ蓄積
  - 処理状況の管理・表示
  - _要件: Requirement 8_

## フェーズ8: データ品質管理機能

- [ ] 29. データ品質評価システムの実装
  - データ品質スコア算出ロジック
  - 重複データ検出機能
  - データ完全性チェック機能
  - _要件: Requirement 9_

- [ ] 30. データ補完・修正機能の実装
  - 不完全データの自動補完提案
  - 重複データのマージ機能
  - データ検証ワークフロー
  - _要件: Requirement 9_

- [ ] 31. 品質管理ダッシュボードの実装
  - データ品質の可視化
  - 改善提案の表示
  - 品質向上の進捗追跡
  - _要件: Requirement 9_

## フェーズ9: 統計・分析機能

- [ ] 32. 基本統計機能の実装
  - 名刺数・企業数等の基本統計
  - 月別登録数のグラフ表示
  - 企業別・タグ別の統計
  - _要件: Requirement 6_

- [ ] 33. 人脈ネットワーク分析の実装
  - 人脈関係の可視化
  - 接触履歴の管理機能
  - 関係強度の算出
  - _要件: Requirement 10_

- [ ] 34. 高度な分析機能の実装
  - 推奨コンタクトの提案
  - ネットワーク分析ダッシュボード
  - フォローアップ提案機能
  - _要件: Requirement 10_

## フェーズ10: データエクスポート機能

- [ ] 35. CSV/JSONエクスポート機能の実装
  - 全データのCSVエクスポート
  - 詳細データのJSONエクスポート
  - 検索結果の選択的エクスポート
  - _要件: Requirement 7_

- [ ] 36. エクスポート機能の拡張
  - エクスポート形式の選択機能
  - 大量データの非同期処理
  - エクスポート履歴の管理
  - _要件: Requirement 7_

## フェーズ11: 高度なデータ可視化・分析機能

### 統合・最適化の方針
フェーズ3.5のTypeScript/React導入により、基本的なUI/UX改善とレスポンシブ対応は統合済み。このフェーズでは高度なデータ可視化と分析機能に特化します。

- [ ] 37. 統計・分析ダッシュボードの高度化
  - Chart.js/D3.js による高度なデータ可視化コンポーネント
  - リアルタイムデータ更新とWebSocket統合
  - 人脈ネットワーク図のインタラクティブ表示
  - ダッシュボードのカスタマイズ機能（ウィジェット配置・フィルター保存）
  - _要件: Requirement 6, 10, 11_
  - _前提: フェーズ3.5のReact/TypeScript基盤構築完了_

- [ ] 38. アドバンスドアクセシビリティ対応
  - WAI-ARIA準拠の高度なアクセシビリティ実装
  - キーボードナビゲーション最適化
  - スクリーンリーダー対応の強化
  - カラーコントラスト・フォントサイズの動的調整
  - _要件: Requirement 11_
  - _注記: 基本的なアクセシビリティはReactコンポーネントで実装済み_

## フェーズ12: API実装

### 統合・最適化の方針
フェーズ3.5でAPI通信層のTypeScript化を実施済みのため、このフェーズでは複雑なビジネスロジック用のAPIに集約します。

- [ ] 39. RESTful API基盤の実装
  - API用コントローラーの作成（認証・エラーハンドリング統一）
  - JSON レスポンス形式の統一（型安全性対応）
  - API認証機能の実装（既存セッション認証との統合）
  - _要件: 全体（API対応）_
  - _前提: フェーズ3.5のAPI通信層TypeScript化完了_

- [ ] 40. 高度な分析・統計API の実装
  - 統計データ取得API（リアルタイム更新対応）
  - 人脈ネットワーク分析API（グラフデータ生成）
  - エクスポート機能API（非同期処理対応）
  - OCR・データ抽出API（画像処理統合）
  - _要件: Requirement 6, 7, 8, 10_
  - _注記: 基本CRUD APIはフェーズ3.5で実装済み_

## フェーズ13: テスト実装・型安全性向上

### 統合・最適化の方針
フェーズ3.5でReactコンポーネントのテスト基盤も構築するため、従来のRailsテスト + フロントエンドテストの統合テスト戦略を採用します。

- [ ] 41. Reactコンポーネントテストの実装
  - Jest + @testing-library/react によるコンポーネントテスト
  - Redux Store・Reducerの単体テスト
  - APIモック・非同期処理のテスト
  - TypeScript型安全性のテスト
  - _要件: 全体（品質保証）+ Requirement 12_
  - _前提: フェーズ3.5のReact基盤構築完了_

- [ ] 42. 統合E2Eテストの実装
  - Rails System Spec + React統合テスト
  - ユーザーシナリオのフルスタック E2E テスト
  - TypeScript/JavaScript機能の ブラウザテスト
  - API連携の統合テスト
  - _要件: 全体（品質保証）_
  - _注記: 既存Railsテスト（330テスト）と統合_

- [ ] 43. RSpec→型シグネチャ自動生成機能の実装
  - RSpecテストコードの解析機能
  - メソッドの引数・戻り値型の推論
  - Sorbet sigの自動生成・挿入
  - TypeScriptとRubyの型安全性統合管理
  - _要件: 全体（コード品質・保守性向上）+ Requirement 12_

## フェーズ14: セキュリティ・パフォーマンス対策

### 統合・最適化の方針
TypeScript/React導入により新たなセキュリティ・パフォーマンス要件が生まれるため、従来のRails対策 + フロントエンド対策を統合します。

- [ ] 44. 統合セキュリティ対策の実装
  - CSRF・XSS対策の強化（React + Rails統合）
  - TypeScript型安全性によるランタイムエラー防止
  - APIエンドポイントのセキュリティ強化
  - ファイルアップロードセキュリティ（画像処理含む）
  - _要件: 非機能要件（セキュリティ）+ Requirement 12_

- [ ] 45. フルスタックパフォーマンス最適化
  - データベースクエリ最適化（N+1問題解決）
  - React コンポーネントのパフォーマンス最適化
  - esbuild ビルド最適化とコード分割
  - キャッシュ戦略（Rails + React状態管理）
  - _要件: 非機能要件（パフォーマンス）+ Requirement 12_

- [ ] 46. 統合監視・ログ機能の実装
  - アプリケーションログの統合（Rails + TypeScript）
  - フロントエンド・エラー監視
  - パフォーマンス監視（Core Web Vitals）
  - ユーザー行動分析（React統合）
  - _要件: 非機能要件（監視）+ Requirement 12_

## フェーズ15: デプロイメント・運用

### 統合・最適化の方針
TypeScript/React資産のビルド・デプロイメントを含む、モダンなフルスタック・デプロイメント戦略を採用します。

- [ ] 47. モダンフルスタック本番環境設定
  - 環境変数の設定（Rails + Node.js統合）
  - TypeScript/React本番ビルド設定
  - SSL/HTTPS設定とCSP強化
  - CDN統合（JavaScript/CSS資産配信）
  - _要件: 非機能要件（デプロイ）+ Requirement 12_

- [ ] 48. CI/CDパイプライン統合構築
  - GitHub Actions（Rails + TypeScript統合テスト）
  - 自動ビルド・テスト・デプロイ（フルスタック対応）
  - TypeScript型チェック・ESLint統合
  - セキュリティスキャン（Ruby + JavaScript）
  - _要件: 非機能要件（CI/CD）+ Requirement 12_

- [ ] 49. 本番デプロイとドキュメント統合整備
  - Heroku/AWSフルスタックデプロイ
  - 技術仕様書の更新（TypeScript/React統合アーキテクチャ）
  - 開発・運用ガイドの整備（フルスタック対応）
  - パフォーマンス・監視運用手順書
  - _要件: 全体（ドキュメント）+ Requirement 12_

## 実装ガイドライン

### 開発原則
- **テスト駆動開発**: 各機能実装前にテストを作成
- **段階的実装**: 小さな単位での実装・テスト・デプロイ
- **コードレビュー**: 全ての変更にセルフレビューを実施
- **ドキュメント**: 実装と同時にドキュメントを更新

### 品質基準
- **テストカバレッジ**: 80%以上を維持
- **コード品質**: RuboCopによる静的解析をパス
- **パフォーマンス**: ページ読み込み3秒以内
- **セキュリティ**: Brakeman による脆弱性チェックをパス

### 完了基準
各タスクは以下の条件を満たした時点で完了とする：
1. 機能が要件通りに動作する
2. 対応するテストが実装され、パスする
3. コードレビューが完了している
4. ドキュメントが更新されている
